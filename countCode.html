<!DOCTYPE html>
<html lang="en" class="loading">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description"
    content="Convex admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, Convex admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>软件度量实验</title>
  <link rel="apple-touch-icon" sizes="60x60" href="app-assets/img/ico/apple-icon-60.png">
  <link rel="apple-touch-icon" sizes="76x76" href="app-assets/img/ico/apple-icon-76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="app-assets/img/ico/apple-icon-120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="app-assets/img/ico/apple-icon-152.png">
  <link rel="shortcut icon" type="image/x-icon" href="app-assets/img/ico/favicon.ico">
  <link rel="shortcut icon" type="image/png" href="app-assets/img/ico/favicon-32.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link
    href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700,900%7CMontserrat:300,400,500,600,700,800,900"
    rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="app-assets/fonts/feather/style.min.css">
  <link rel="stylesheet" type="text/css" href="app-assets/fonts/simple-line-icons/style.css">
  <link rel="stylesheet" type="text/css" href="app-assets/fonts/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="app-assets/vendors/css/perfect-scrollbar.min.css">
  <link rel="stylesheet" type="text/css" href="app-assets/vendors/css/prism.min.css">
  <link rel="stylesheet" type="text/css" href="app-assets/css/app.css">
  <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
</head>

<body data-col="2-columns" class=" 2-columns ">
  <!-- ////////////////////////////////////////////////////////////////////////////-->
  <div class="wrapper" style="background: url('app-assets/img/photos/op-bg.jpg')  no-repeat;background-size: 100% auto;">


    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Navbar</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="index.html">首页 <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item dropdown  active">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false">
              需求分析
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="UCPMetrics.html">用例点</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item  disabled" href="FPMetrics.html">功能点度量</a>
            </div>
          </li>
          <li class="nav-item dropdown active">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false">
              详细设计
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="LKMetrics.html">面向对象LK度量</a>
              <a class="dropdown-item" href="CKMetrics.html">面向对象CK度量</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item disabled" href="VG.html" >圈复杂度度量</a>
            </div>
          </li>
          <li class="nav-item  active ">
            <a class="nav-link" href="countCode.html" tabindex="-1">编码实现</a>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="search" placeholder="Search..." aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">搜索</button>
        </form>
      </div>
    </nav>

    <div class="main-panel">
      <div>
        <div class="content-wrapper">
          <div class="container-fluid">

            <!-- Basic File Browser start -->
            <section class="file-browser">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-header">
                      <div class="card-title-wrap bar-danger">
                        <h4 class="card-title mb-0">代码行统计</h4>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="card-block">
                        <form class="form">
                          <div class="form-body">
                            <div class="row">
                              <div class="col-lg-11 col-md-11">
                                <div class="input-group mb-3">
                                  <div class="input-group-prepend">
                                    <span class="input-group-text">上传文件</span>
                                  </div>
                                  <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="inputFile">
                                    <label class="custom-file-label" for="inputGroupFile01" id="fileName">点击选择文件夹上传代码</label>
                                  </div>
                                </div>
                              </div>
                              <div class="col-lg-1 col-md-1">
                                <a class="btn mr-1 btn-success" id="checkBtn">确定</a>
                              </div>
                            </div>
                          </div>
                      </form>
                      <div class="row" id="main">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
          </div>
          </section>
          <section id="user-profile">
            <div class="row">
                <div class="col-12">
                    <div class="card profile-with-cover">
                        <div class="card-img-top img-fluid bg-cover height-300" style="background: url('app-assets/img/photos/14.jpeg') 50%;"></div>
                        <div class="media profil-cover-details row">
                            <div class="col-5 mr-auto">
                                <div class="align-self-start halfway-fab pl-3 pt-2">
                                    
                                </div>
                            </div>
                        </div>
              
                    </div>
                </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <footer class="footer footer-static footer-light">
      <p class="clearfix text-muted text-center px-2"><span>Copyright &copy; 2021 <a
            href="https://www.csu.edu.cn" id="pixinventLink" target="_blank"
            class="text-bold-800 primary darken-2">CSU</a>, All rights reserved. </span></p>
    </footer>

  </div>
  </div>
  <!-- ////////////////////////////////////////////////////////////////////////////-->


  <!-- BEGIN VENDOR JS-->
  <script src="app-assets/vendors/js/core/jquery-3.3.1.min.js"></script>
  <script src="app-assets/vendors/js/core/popper.min.js"></script>
  <script src="app-assets/vendors/js/core/bootstrap.min.js"></script>
  <script src="app-assets/vendors/js/perfect-scrollbar.jquery.min.js"></script>
  <script src="app-assets/vendors/js/prism.min.js"></script>
  <script src="app-assets/vendors/js/jquery.matchHeight-min.js"></script>
  <script src="app-assets/vendors/js/screenfull.min.js"></script>
  <script src="app-assets/vendors/js/pace/pace.min.js"></script>
  <!-- BEGIN VENDOR JS-->
  <!-- BEGIN PAGE VENDOR JS-->
  <!-- END PAGE VENDOR JS-->
  <!-- BEGIN CONVEX JS-->
  <script src="app-assets/js/app-sidebar.js"></script>
  <script src="app-assets/js/notification-sidebar.js"></script>
  <!-- END CONVEX JS-->
  <!-- BEGIN PAGE LEVEL JS-->
  <!-- END PAGE LEVEL JS-->

  <script>
        var data;

        $(document).ready(function (){ 
          $("#inputFile").change(function(){
              $("#fileName").text("已选择文件："+$("#inputFile")[0].files[0].name);
              var reader = new FileReader();
                reader.readAsText($("#inputFile")[0].files[0], "UTF-8");//读取文件 
                reader.onload = function(evt){ //读取完文件之后会回来这里
                    data =  evt.target.result;
                }
          });

            $("#checkBtn").click(function () {
                $.ajax({
                    url: "http://127.0.0.1:8080/countCode",
                    type:'post',
                    async: false,//使用同步的方式,true为异步方式
                    processData: false,
                    contentType:"application/octet-stream",
                    data: data,
                    // contentType:"text/plain",
                    success:function(data){
                        console.log(data)
                        for(var i=0;i<data.length;i++){
                            //对于每一个file都要建立一个图表
                            
                            //1. 插入一个新的元素
                            $("#main").append(
                                '<div class="col-lg-6 col-md-12" id="'+data[i].fileName+'" style="width: 600px;height:400px;"></div>'
                            )

                            //2.获取一些数据
                            var arr = new Array();

                            var object1 = new Object();
                            object1.name = '代码行数';
                            object1.value = data[i].codeLines;
                            arr.push(object1)

                            var object2 = new Object();
                            object2.name = '空白行数';
                            object2.value = data[i].blankLines;
                            arr.push(object2)

                            var object3 = new Object();
                            object3.name = '注释行数';
                            object3.value = data[i].commentLines;
                            arr.push(object3)

                            //3. 创建一个图表
                            var myChart = echarts.init(document.getElementById(data[i].fileName),'light');

                            //4. 指定图表的配置项和数据
                            var option = {
                                title: {
                                    text: $("#inputFile")[0].files[0].name,
                                    // x 设置水平安放位置，默认左对齐，可选值：'center' ¦ 'left' ¦ 'right' ¦ {number}（x坐标，单位px）
                                    x: 'center',
                                    // y 设置垂直安放位置，默认全图顶端，可选值：'top' ¦ 'bottom' ¦ 'center' ¦ {number}（y坐标，单位px）
                                    y: 'top',
                                    // itemGap设置主副标题纵向间隔，单位px，默认为10，
                                    itemGap: 30,
                                    backgroundColor: '#EEE',
                                    // 主标题文本样式设置
                                    textStyle: {
                                        fontSize: 26,
                                        fontWeight: 'bolder',
                                        color: '#000080'
                                    },
                                    // 副标题文本样式设置
                                    subtextStyle: {
                                        fontSize: 18,
                                        color: '#8B2323'
                                    }
                                },
                                graphic:{
                                    type:"text",
                                    left:"center",
                                    top:"85%",
                                    style:{
                                        text:"注释密度："+(object3.value/(object3.value+object1.value)*100).toFixed(2)+'%',
                                        textAlign:"center",
                                        fill:"#333",
                                        fontSize:15,
                                        fontWeight:600
                                    }
                                },
                                series : [{
                                        name: '代码行统计结果',
                                        type: 'pie',
                                        radius: '55%',
                                        roseType: 'angle',
                                        data:arr,
                                        label: {
                                            normal: {
                                                textStyle : {
                                                    fontWeight : 600 ,
                                                    fontSize : 16    //文字的字体大小
                                                },
                                                position: 'outer',  // 设置标签位置，默认在饼状图外 可选值：'outer' ¦ 'inner（饼状图上）'
                                                // formatter: '{a} {b} : {c}个 ({d}%)'   设置标签显示内容 ，默认显示{b}
                                                // {a}指series.name  {b}指series.data的name
                                                // {c}指series.data的value  {d}%指这一部分占总数的百分比
                                                formatter: '{b}:{c}行'
                                            }
                                        }
                                    }]
                                };
                    
                            // 使用刚指定的配置项和数据显示图表。
                            myChart.setOption(option);

                        }
                    },
                    error: function(data) {
                        console.log(data)
                    }
                });
                
            });
        });      

  </script>
</body>

</html>

